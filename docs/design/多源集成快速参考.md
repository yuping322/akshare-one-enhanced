# å¤šæºé›†æˆå¿«é€Ÿå‚è€ƒ

## å¿«é€Ÿæ£€æŸ¥è¡¨ï¼šæ¯ç§æ•°æ®ç±»å‹çš„æ¨èæºä¼˜å…ˆçº§

### è‚¡ç¥¨å†å²è¡Œæƒ… (historical)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èä½¿ç”¨åœºæ™¯ |
|--------|-----|------|------|------------|
| 1ï¸âƒ£ | eastmoney_direct | æ•°æ®å®Œæ•´ã€æ›´æ–°å¿«ã€APIç¨³å®š | - | ä¸»è¦é€‰æ‹© |
| 2ï¸âƒ£ | eastmoney | ä¸ eastmoney_direct æ•°æ®ä¸€è‡´ | é€Ÿåº¦ç¨æ…¢ | å¤‡ç”¨ |
| 3ï¸âƒ£ | sina | ç¨³å®šå¯é ã€å†å²æ‚ ä¹… | é€Ÿåº¦å¯èƒ½æ…¢ã€æœ‰IPé™åˆ¶ | åº”æ€¥å¤‡ç”¨ |
| 4ï¸âƒ£ | tencent | å®æ—¶æ€§å¼ºã€å“åº”å¿« | åˆ†é’Ÿæ•°æ®ä¸»è¦ | é«˜é¢‘éœ€æ±‚ |

**å®ç°éš¾åº¦**: â­ (æ˜“)
**é¢„æœŸæ”¶ç›Š**: â­â­â­â­ (é«˜)

---

### è‚¡ç¥¨å®æ—¶è¡Œæƒ… (realtime)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èä½¿ç”¨åœºæ™¯ |
|--------|-----|------|------|------------|
| 1ï¸âƒ£ | eastmoney_direct | æ•°æ®å‡†ç¡®ã€æ ¼å¼å®Œæ•´ | - | ä¸»è¦é€‰æ‹© |
| 2ï¸âƒ£ | eastmoney | å¤‡ç”¨ | é€Ÿåº¦ç¨æ…¢ | å¤‡ç”¨ |
| 3ï¸âƒ£ | xueqiu | ç”¨æˆ·å‹å¥½ | è·å–å›°éš¾ | éä¸»æµ |
| â• | tencent | å“åº”å¿«ã€å‡†ç¡® | ä»£ç æ˜ å°„å¤æ‚ | é«˜é¢‘äº¤æ˜“ |
| â• | ths | åˆ†æå·¥å…·é½å…¨ | æ¥å£ä¸ç¨³å®š | é¾™è™æ¦œç›¸å…³ |

**å®ç°éš¾åº¦**: â­â­ (ä¸­ç­‰)
**é¢„æœŸæ”¶ç›Š**: â­â­â­ (ä¸­)

---

### è´¢åŠ¡æ•°æ® (financial)

| ä¼˜å…ˆçº§ | æº | æ•°æ®ç±»å‹ | ä¼˜ç‚¹ | æ¨èä¼˜å…ˆçº§ |
|--------|-----|----------|------|----------|
| 1ï¸âƒ£ | eastmoney_direct | èµ„äº§è´Ÿå€ºè¡¨/åˆ©æ¶¦è¡¨/ç°é‡‘æµ | æ•°æ®æƒå¨ã€æ›´æ–°åŠæ—¶ | â­â­â­â­â­ |
| 2ï¸âƒ£ | sina | èµ„äº§è´Ÿå€ºè¡¨/åˆ©æ¶¦è¡¨/ç°é‡‘æµ | æ•°æ®å‡†ç¡®ã€å¤‡ç”¨å¯é  | â­â­â­â­ |
| 3ï¸âƒ£ | cninfo (å·¨æ½®) | å®˜æ–¹æŠ«éœ²æ•°æ® | æƒå¨æ€§æœ€é«˜ | â­â­â­â­â­ |

**å®ç°éš¾åº¦**: â­â­ (ä¸­ç­‰)
**é¢„æœŸæ”¶ç›Š**: â­â­â­â­ (é«˜)

---

### åŸºç¡€ä¿¡æ¯ (info)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | æ¨èåœºæ™¯ |
|--------|-----|------|----------|
| 1ï¸âƒ£ | eastmoney | ä¿¡æ¯å®Œæ•´ã€å‡†ç¡® | ä¸»è¦ |
| 2ï¸âƒ£ | sina | å¤‡ç”¨ã€å¯é  | åº”æ€¥ |

**å®ç°éš¾åº¦**: â­ (æ˜“)
**é¢„æœŸæ”¶ç›Š**: â­â­ (ä½)

---

### æ–°é—»æ•°æ® (news)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | æ¨èåœºæ™¯ |
|--------|-----|------|----------|
| 1ï¸âƒ£ | eastmoney | æ–°é—»å…¨é¢ã€åŠæ—¶ | ä¸»è¦ |
| 2ï¸âƒ£ | sina | å¤‡ç”¨ã€ç¨³å®š | åº”æ€¥ |

**å®ç°éš¾åº¦**: â­ (æ˜“)
**é¢„æœŸæ”¶ç›Š**: â­â­ (ä½)

---

### æœŸè´§æ•°æ® (futures)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | æ¨èåœºæ™¯ |
|--------|-----|------|----------|
| 1ï¸âƒ£ | sina | æ•°æ®å®Œæ•´ã€ç¨³å®š | ä¸»è¦ |
| 2ï¸âƒ£ | eastmoney | å¤‡ç”¨ | åº”æ€¥ |
| 3ï¸âƒ£ | äº¤æ˜“æ‰€ API | æƒå¨å‡†ç¡® | åˆçº¦è¯¦æƒ… |

**å®ç°éš¾åº¦**: â­â­â­ (é«˜)
**é¢„æœŸæ”¶ç›Š**: â­â­â­ (ä¸­)

---

### å†…éƒ¨äº¤æ˜“ (insider)

| ä¼˜å…ˆçº§ | æº | ä¼˜ç‚¹ | æ¨èåœºæ™¯ |
|--------|-----|------|----------|
| 1ï¸âƒ£ | xueqiu | æ¥å£è®¾è®¡å‹å¥½ | ä¸»è¦ |
| 2ï¸âƒ£ | sina | å¤‡ç”¨ã€ç¨³å®š | åº”æ€¥ |

**å®ç°éš¾åº¦**: â­ (æ˜“)
**é¢„æœŸæ”¶ç›Š**: â­ (ä½)

---

## æŒ‰æ¨¡å—å®ç°é¡ºåº (å»ºè®®)

### ç¬¬ä¸€é˜¶æ®µ (1-2å‘¨) â­â­â­â­â­ é«˜ä¼˜å…ˆçº§

1. **å†å²æ•°æ® (historical)** 
   - æ·»åŠ : tencent, sina (ç½‘æ˜“)
   - å·¥ä½œé‡: ä½
   - æ”¶ç›Š: é«˜
   - ä¾èµ–: EnhancedRouter âœ… å®Œæˆ

2. **å®æ—¶æ•°æ® (realtime)** 
   - æ·»åŠ : tencent, ths
   - å·¥ä½œé‡: ä¸­
   - æ”¶ç›Š: ä¸­
   - ä¾èµ–: EnhancedRouter âœ… å®Œæˆ

3. **åŸºç¡€ä¿¡æ¯ (info)**
   - æ·»åŠ : sina
   - å·¥ä½œé‡: ä½
   - æ”¶ç›Š: ä½
   - ä¾èµ–: EnhancedRouter âœ… å®Œæˆ

### ç¬¬äºŒé˜¶æ®µ (2-3å‘¨) â­â­â­â­ é‡è¦

1. **è´¢åŠ¡æ•°æ® (financial)**
   - æ·»åŠ : cninfo, sina
   - å·¥ä½œé‡: ä¸­
   - æ”¶ç›Š: é«˜

2. **æ–°é—»æ•°æ® (news)**
   - æ·»åŠ : sina
   - å·¥ä½œé‡: ä½
   - æ”¶ç›Š: ä½

3. **å†…éƒ¨äº¤æ˜“ (insider)**
   - æ·»åŠ : sina
   - å·¥ä½œé‡: ä½
   - æ”¶ç›Š: ä½

### ç¬¬ä¸‰é˜¶æ®µ (3-4å‘¨) â­â­â­ ä¼˜åŒ–

1. **æœŸè´§æ•°æ® (futures)**
   - æ·»åŠ : eastmoney, äº¤æ˜“æ‰€API
   - å·¥ä½œé‡: é«˜
   - æ”¶ç›Š: ä¸­

2. **æœŸæƒæ•°æ® (options)**
   - æ·»åŠ : eastmoney
   - å·¥ä½œé‡: ä¸­
   - æ”¶ç›Š: ä¸­

---

## ä»£ç ç¤ºä¾‹å¯¹æ¯”

### å•æº vs å¤šæºè°ƒç”¨å¯¹æ¯”

**ä¼ ç»Ÿå•æºè°ƒç”¨**:
```python
from akshare_one import get_hist_data

# å¦‚æœ eastmoney_direct å¤±è´¥å°±å…¨éƒ¨å¤±è´¥
df = get_hist_data("600000", interval="day", source="eastmoney_direct")
```

**æ–°çš„å¤šæºè°ƒç”¨**:
```python
from akshare_one import create_historical_router

# è‡ªåŠ¨å°è¯•å¤šä¸ªæºï¼Œç¬¬ä¸€ä¸ªå¤±è´¥è‡ªåŠ¨è½¬ç§»åˆ°ä¸‹ä¸€ä¸ª
router = create_historical_router(
    symbol="600000",
    interval="day",
    sources=["eastmoney_direct", "eastmoney", "sina", "tencent"],
)
df = router.execute("get_hist_data")
```

**è·å–è¯¦ç»†ä¿¡æ¯**:
```python
result = router.execute_with_result("get_hist_data")

if result.success:
    print(f"âœ… Data from: {result.source}")
    print(f"ğŸ“Š Rows: {len(result.data)}")
    df = result.data
else:
    print(f"âŒ Failed after {result.attempts} attempts:")
    for source, error in result.error_details:
        print(f"   {source}: {error}")

# æŸ¥çœ‹å†å²ç»Ÿè®¡
stats = router.get_stats()
print(stats)
# {'eastmoney_direct': {'success': 5, 'failure': 1},
#  'eastmoney': {'success': 2, 'failure': 0},
#  'sina': {'success': 1, 'failure': 0}}
```

---

## é€šç”¨å®ç°æ­¥éª¤ (é’ˆå¯¹ä»»ä½•æ–°æº)

### æ­¥éª¤1: åˆ›å»ºæºå®ç°æ–‡ä»¶

```bash
# ä¾‹å¦‚æ·»åŠ è…¾è®¯è´¢ç»å®æ—¶è¡Œæƒ…
touch src/akshare_one/modules/realtime/tencent.py
```

**æ–‡ä»¶æ¨¡æ¿**:
```python
"""Tencent Finance - Real-time data provider"""

from typing import Any
import pandas as pd
import requests
from .base import RealtimeDataProvider


class TencentRealtime(RealtimeDataProvider):
    """Tencent real-time data implementation"""
    
    def __init__(self, symbol: str, *args: Any, **kwargs: Any) -> None:
        super().__init__(symbol, *args, **kwargs)
    
    def get_current_data(self) -> pd.DataFrame:
        """Fetch current data from Tencent Finance"""
        # å®ç°é€»è¾‘...
        pass
```

### æ­¥éª¤2: åœ¨ Factory ä¸­æ³¨å†Œ

ç¼–è¾‘ `modules/realtime/factory.py`:

```python
from .tencent import TencentRealtime  # æ·»åŠ å¯¼å…¥

class RealtimeDataFactory:
    _providers = {
        # ... ç°æœ‰ ...
        "tencent": TencentRealtime,  # æ·»åŠ æ³¨å†Œ
    }
```

### æ­¥éª¤3: æ›´æ–°è·¯ç”±å™¨é»˜è®¤æº

ç¼–è¾‘ `modules/multi_source.py`:

```python
def create_realtime_router(...):
    if sources is None:
        sources = [
            "eastmoney_direct",
            "eastmoney",
            "xueqiu",
            "tencent",  # æ·»åŠ 
        ]
```

### æ­¥éª¤4: ç¼–å†™æµ‹è¯•

```bash
cat > tests/test_new_source.py << 'EOF'
def test_new_source():
    from akshare_one import create_historical_router
    
    router = create_historical_router(
        symbol="600000",
        sources=["new_source"],
    )
    df = router.execute("get_hist_data")
    assert not df.empty
EOF
```

### æ­¥éª¤5: éªŒè¯ä¸æäº¤

```bash
# è¿è¡Œæµ‹è¯•
pytest tests/test_new_source.py -v

# æ£€æŸ¥ä»£ç é£æ ¼
ruff check src/

# ç±»å‹æ£€æŸ¥
mypy src/

# æäº¤
git add .
git commit -m "feat: add new_source data provider for historical data"
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·³è¿‡å¤±è´¥çš„æºè€Œä¸ç­‰å¾…è¶…æ—¶?

**A**: åœ¨ Provider ä¸­è®¾ç½®æ›´çŸ­çš„ timeout:

```python
class TencentRealtime(RealtimeDataProvider):
    def get_current_data(self) -> pd.DataFrame:
        try:
            r = requests.get(url, timeout=3)  # â† è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´
        except requests.Timeout:
            raise ValueError("Request timeout")
```

### Q2: å¦‚ä½•è‡ªå®šä¹‰æºä¼˜å…ˆçº§?

**A**: åœ¨åˆ›å»ºè·¯ç”±å™¨æ—¶æŒ‡å®šæºé¡ºåº:

```python
router = create_historical_router(
    symbol="600000",
    sources=[
        "sina",              # ä¼˜å…ˆä½¿ç”¨æ–°æµª
        "eastmoney_direct",  # å…¶æ¬¡ä¸œè´¢
        "tencent",          # æœ€åè…¾è®¯
    ]
)
```

### Q3: å¦‚ä½•åˆ¤æ–­æ˜¯å¦éœ€è¦æ–°å¢æ•°æ®æº?

**A**: æ£€æŸ¥ä»¥ä¸‹æ¡ä»¶:

1. âœ… ç°æœ‰æºç»å¸¸å¤±è´¥ â†’ éœ€è¦å¤‡ç”¨æº
2. âœ… æ•°æ®æ›´æ–°ä¸åŠæ—¶ â†’ å¯»æ‰¾æ›´åŠæ—¶çš„æº
3. âœ… å­—æ®µä¸å®Œæ•´ â†’ è¡¥å……æº
4. âœ… ç”¨æˆ·éœ€æ±‚ â†’ ä¼˜å…ˆå®ç°

### Q4: æ–°æºçš„ä»£ç æ˜ å°„ä¸åŒæ€ä¹ˆåŠ?

**A**: åœ¨ Provider ä¸­å®ç°è½¬æ¢æ–¹æ³•:

```python
def _convert_symbol(self) -> str:
    """Convert akshare-one format to source-specific format"""
    if self.symbol.startswith("6"):
        return f"sh{self.symbol}"  # æ–°æµªæ ¼å¼
    else:
        return f"sz{self.symbol}"
```

---

**æœ€åæ›´æ–°**: 2026-02-12
